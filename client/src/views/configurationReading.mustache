<!DOCTYPE html>
<head>
    <!--head-->
    <title><!--title--> - New Reading</title>
</head>
<body>
    <!--nav-->

    <div class="container">
        {{#canEdit}}
        <form id="form" action="./readingDo" method="post">
            <div class="row">

                <div class="col-xs-12 col-md-7">

                    <h2>New Reading</h2>
                    <a href="./">&lt; Back to Configuration ({{configuration.name}})</a>
                    <br><br>

                    <!-- Location + Time -->
                    <div class="js">
                        <button id="locationget" type="button" class="btn btn-sm btn-primary" onclick="getLocation()">Get Location</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        <label class="custom-control custom-checkbox">
                            <input type="checkbox" id="locationalways" class="custom-control-input">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description">Get Location Automatically</span>
                        </label>
                        <br><br>
                        <div class="map" id="map"></div>
                    </div>

                    <br>

                    <!-- Lat/Long -->
                    <div class="row">

                        <!-- Latitude -->
                        <div class="col-xs-6 col-xxs-12">
                            <label class="control-label">Latitude</label>
                            <div class="input-group">
                                <input  name="location.lat" class="form-control"
                                        type="number" step="any"
                                        min="-90" max="90"
                                        aria-describedby="addon-location_lat">
                                <br>
                                <span class="input-group-addon" id="addon-location_lat">Degrees</span>
                            </div>
                        </div>

                        <!-- Longitude -->                    
                        <div class="col-xs-6 col-xxs-12">
                            <label class="control-label">Longitude</label>
                            <div class="input-group">
                                <input  name="location.long" class="form-control"
                                        type="number" step="any" min="-180" max="180"
                                        aria-describedby="addon-location_long">
                                <span class="input-group-addon" id="addon-location_long">Degrees</span>
                            </div>
                        </div>

                    </div>

                    <br>

                    <div class="spoiler reading-more" data-spoiler-link="location"></div>
                    <div class="spoiler-content row" data-spoiler-link="location">

                        <!-- Time Created -->
                        <div class="col-xs-12">
                            <label class="control-label">
                                Time Created
                            </label>
                            <input  name="timeCreated" class="form-control normalize"
                                    type="number" value="{{timeCurrent}}"
                                    data-unittype="time" data-unit="unix" data-unitpref="iso">
                            <br>
                        </div>

                        <!-- Range -->
                        <div class="col-sm-4 col-xs-12">
                            <label class="control-label">Range (Optional)</label>
                            <div class="input-group">
                                <input  name="location.range" class="form-control normalize"
                                        type="number" step="any" min="0"
                                        aria-describedby="addon-location_range"
                                        data-unittype="length" data-unit="meters" data-unitpref="feet">
                                <span class="input-group-addon" id="addon-location_range">Meters</span>
                            </div>
                            <br>
                        </div>
                    

                        <!-- Altitude -->
                        <div class="col-sm-4 col-xs-12">
                            <label class="control-label">Altitude (Optional)</label>
                            <div class="input-group">
                                <input  name="location.alt" class="form-control normalize" id="location_alt"
                                        type="number" step="any" 
                                        aria-describedby="addon-location_alt"
                                        data-unittype="length" data-unit="meters" data-unitpref="feet">
                                <span class="input-group-addon" id="addon-location_alt">Meters</span>
                            </div>
                            <br>
                        </div>
                    
                        <!-- Altitude Range -->
                        <div class="col-sm-4 col-xs-12">
                            <label class="control-label">Altitude Range (Optional)</label>
                            <div class="input-group">
                                <input  name="location.altRange" class="form-control normalize" id="location_altRange" 
                                        type="number" step="any" min="0"
                                        aria-describedby="addon-location_altRange"
                                        data-unittype="length" data-unit="meters" data-unitpref="feet">
                                <span class="input-group-addon" id="addon-location_altRange">Meters</span>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="col-xs-12 col-md-5">
                    <br>
                    <h3 class="h-inline">Sensors</h3>
                    &nbsp;&nbsp;
                    <a id="sensor-new" href="/sensors/new?configuration={{configuration._id}}" class="btn btn-sm btn-primary">Add New</a>
                    &nbsp;&nbsp;
                    <a id="sensor-existing" href="./addSensor" class="btn btn-sm btn-secondary">Add Existing</a>
                    <br>
                    <div id="sensors">
                        {{#sensors}}
                        <div class="sensor" id="sensor_{{_id}}">
                            <a href="/sensors/{{_id}}"><h4 class="h-inline">{{name}}</h4></a><br>
                            {{{html}}}
                            <br>
                        </div>
                        {{/sensors}}
                        {{^sensors}}
                        <p id="sensors-none">No sensors found for this configuration.</p>
                        {{/sensors}}
                    </div>

                    <div class="form-group">
                        <div>
                            <a href="./" class="btn btn-default">Cancel</a>
                            &nbsp;&nbsp;
                            <button type="submit" name="publish" class="btn btn-primary">Save and Publish</button>
                        </div>
                    </div>

                </div>

            </div>
        </form>
        {{/canEdit}}
        {{^canEdit}}
        <h2>New Reading</h2>
        &nbsp;&nbsp;&nbsp;Configuration <a href="./">{{configuration.name}} ({{configuration._id}})</a>
        <br><br>
        <p>Sorry, you do not have permission to create a reading.
        {{/canEdit}}
    </div>

    <div id="modal-sensor-new" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Create a New Sensor</h4>
                </div>
                <div class="modal-step modal-body modal-step-1">
                    <h5>Select a type.</h5>
                    <ul id="modal-sensor-types" class="list-group"></ul>
                </div>
                <div class="modal-step modal-body modal-step-2">
                    <h5>Select a model.</h5>
                    <ul id="modal-sensor-models" class="list-group"></ul>                  
                </div>
                <div class="modal-step modal-body modal-step-loading">
                    <p>Loading...</p>
                </div>
                <div class="modal-step modal-body modal-step-error">
                    <p>An error has occurred. (<span class="modal-error"></span>)</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-sensor-existing" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Add an Existing Sensor</h4>
                </div>
                <div class="modal-step modal-body modal-step-1">
                    <h5>Select a sensor.</h5>
                    <ul id="sensors-existing" class="list-group"></ul>
                </div>
                <div class="modal-step modal-body modal-step-loading">
                    <p>Loading...</p>
                </div>
                <div class="modal-step modal-body modal-step-error">
                    <p>An error has occurred. (<span class="modal-error"></span>)</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <!--scripts-->

    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAsPFPL4ttV7hbmVIF-BELdB9WD_c5SjJA&callback=initMap">
    </script>
    <script src="/js/lib/jQuery.unitnorm.js"></script>
    <script src="/js/lib/jquery.spoiler.min.js"></script>
    <script src="/js/lib/modernizr-custom.js"></script>
    <script src="/js/lib/bootstrap-datetimepicker.min.js"></script>
    <script src="/js/reading.js"></script>

</body>